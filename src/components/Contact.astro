---
import useTranslations from "@utils/i18n";
import Title from "./ui/Title.astro";

const t = useTranslations(Astro.currentLocale || "es");
---

<section class="mt-16 max-w-3xl mx-auto px-4" id="contact">
  <Title title={t("form.title")} />

  <form
    id="contactForm"
    name="contact"
    method="POST"
    data-netlify="true"
    class="mt-8 space-y-6 bg-neutral-900 p-6 rounded-xl
         shadow-[0_35px_80px_rgba(236,72,153,0.25)]
         border border-purple-500/20"
  >
    <input type="hidden" name="form-name" value="contact" />
    <!-- Nombre -->
    <div>
      <label class="block text-sm text-neutral-300 mb-1">
        {t("form.name")}
      </label>
      <input
        type="text"
        name="name"
        placeholder="Anthony Volquez"
        class="w-full rounded-md bg-neutral-800 border border-neutral-700 px-4 py-2 text-neutral-100 placeholder-neutral-500 focus:outline-none focus:ring-2 focus:ring-purple-500"
        required
      />
    </div>

    <!-- Email -->
    <div>
      <label class="block text-sm text-neutral-300 mb-1">
        {t("form.email")}
      </label>
      <input
        type="email"
        name="email"
        placeholder="example@example.com"
        class="w-full rounded-md bg-neutral-800 border border-neutral-700 px-4 py-2 text-neutral-100 placeholder-neutral-500 focus:outline-none focus:ring-2 focus:ring-purple-500"
        required
      />
    </div>

    <!-- Mensaje -->
    <div>
      <label class="block text-sm text-neutral-300 mb-1">
        {t("form.message")}
      </label>
      <textarea
        name="message"
        rows="5"
        placeholder={t("form.messagePlaceholder")}
        class="w-full rounded-md bg-neutral-800 border border-neutral-700 px-4 py-2 text-neutral-100 placeholder-neutral-500 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none"
        required></textarea>
    </div>

    <!-- Botón -->
    <button
      type="submit"
      class="w-full rounded-md cursor-pointer bg-[#ec4899] font-bold py-3 text-white
         transition-all duration-300 ease-out
         hover:bg-purple-700 hover:scale-[1.02] hover:shadow-xl
         focus:outline-none focus:ring-2 focus:ring-purple-400 focus:ring-offset-2
         active:scale-[0.98]"
    >
      {t("form.submit")}
    </button>
  </form>
</section>

<script>
  import Toastify from "toastify-js";
  import "toastify-js/src/toastify.css";

  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById(
      "contactForm"
    ) as HTMLFormElement | null;

    if (!form) return;

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const data = new FormData(form);

      try {
        const response = await fetch("/", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams(data).toString(),
        });

        if (response.ok) {
          Toastify({
            text: "¡Mensaje enviado con éxito!",
            duration: 3000,
            gravity: "top",
            position: "right",
            backgroundColor: "linear-gradient(to right, #00b09b, #96c93d)",
          }).showToast();

          form.reset();
        } else {
          Toastify({
            text: "Error al enviar el mensaje",
            duration: 3000,
            gravity: "top",
            position: "right",
            backgroundColor: "linear-gradient(to right, #ff5f6d, #ffc371)",
          }).showToast();
        }
      } catch (err) {
        Toastify({
          text: "Error al enviar el mensaje",
          duration: 3000,
          gravity: "top",
          position: "right",
          backgroundColor: "linear-gradient(to right, #ff5f6d, #ffc371)",
        }).showToast();
      }
    });
  });
</script>
